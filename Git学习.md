# Git学习
*Git的命令和参数很多，此处仅为简单的记录，详细请参考git在线手册*
## Git的本地结构
*在git bash终端中鼠标选中终端里的文本就已经自动复制了，不需要按快捷键*
本地结构不会涉及到远程部分，大致分为三部分
**本地库：** 这部分存储历史版本信息
**暂存区：** 这部分是你打算提交的代码，但是还没有提交，将来可以**通过git commit把这部分提交到本地库**。
**工作区：** 通俗的说这部分就是你写代码的工程目录，类似于VS等软件的workspace。
工作区可以**通过git add提交到暂存区**
## Git的步骤
1 一般来说你想上传的工程都放在一个专门的文件夹下。
2 右键进入Git bash终端
3 输入初始化本地仓库命令
4 把工作区文件上传到暂存区
5 把暂存区文件上传到本地区
## Git新旧版本的差异
### 主分支名字差异
旧版默认主分支的名字是master，且之前在github的网页端可以看见默认的主分支是master，现在改为main。还需要手动修改默认分支。在新版git安装中可以选择继续用旧名字master还是main，我一路默认下来还是master。
### 推送差异
旧版本第一次推送时需要设置token比较麻烦，否则会报错如下
```sh
Logon failed, use ctrl+c to cancel basic credential prompt
#此处省略1000字
```
解决方法
https://blog.csdn.net/weixin_46622106/article/details/111914231
新版(我目前是2.40)git bash推送时直接选择浏览器认证登录即可避免

## Git常用命令
Git中兼容很多linux命令，并且也可以用tab补全和cd切换目录
### 升级Git版本
随便在个文件夹打开git bash 输入
```sh
git update-git-for-windows
```
就会自动下载，安装时会自动卸载旧版本
### 查看版本信息
```sh
    git --version
```
输出当前的版本信息
### 清屏
    clear
### 设置上传者信息
```sh
    git config --global user.name "此处填写用户名"
    git config --global user.email "此处填写你的注册邮箱"
```
这个--global就是设置为全局用户，填写的用户名和邮箱就是你的github账号
### 初始化本地仓库(重要)
```sh
    git init
```
此时会生成一个.git的隐藏文件夹，包含git的各种配置信息，不要随便动里面的内容
### add提交暂存区
此时你的文件还在工作区，需要先用add命令提交到暂存区
```sh
    git add "test.txt"
```
上述命令把test.txt文件上传到暂存区
### commit上传本地区
```sh
git commit -m "此处填写所要提交文件的注释信息"
```
-m表示添加后面的注释信息
**不放在本地仓库路径中的文件，git是不进行管理的，即使放在本地仓库路径，也必须通过add和commit操作后将内容提交到本地区才能进行管理**
### status查看状态
该命令查看工作区和暂存区的状态
在本地仓库的路径下执行
```sh
git status
```
*修改要上传的文件内容之后，输入Status命令会显示红色信息，提醒你文件内容已修改，这时候要git add "文件名"这样更新一下，然后再对这个文件执行一下commit*
### log看日志
这条命令可以查看提交的，显示从最近到最远的日志

*方式一*
```sh
git log
```
输入该命令之后，会输出各种信息，**往下翻如果有冒号，说明还有下一页，按下空格翻页，按下b返回上一页，显示END说明到最后一页了，按下q可以退出查看**

*方式二*
```sh
git log --pretty=oneline
```
*方式三*
```sh
git log --oneline
```
*方式四*
```sh
git reflog
```
这种方式在每次的提交记录后面都会跟着一个**HEAD@{x}**，这个是提醒用户，如果你想回退到某个版本需要x步。
### reset前进后退版本
该命令可以进行简单的版本控制
对同一份文件进行多次修改之后且每次修改都进行一次上传进本地区的操作，
此时使用*git reflog*命令查看日志。假设日志如下(具体索引号省略)
```sh
索引号1 (HEAD->master) HEAD@{0}: commit: insert ccc
// 这行语句表示现在所在的版本以及改动。insert ccc是当时提交的注释信息
索引号2 HEAD@{1}: commit: insert bbb
索引号3 HEAD@{2}: commit: insert aaa
索引号4 HEAD@{3}: commit: 我创建了test.txt
```
上述日志从上到下是按照由近到远的时间来的。
*如果你想跳转到索引号2的版本*输入
```sh
git reset --hard 索引号2
```
执行完之后，对应的文件也会发生修改，回退到当时的版本
**执行这个reset命令之后，本地区指针移动的同时，重置暂存区和工作区**
把hard参数换为**mixed**参数，执行后本地区指针移动的同时，重置暂存区，但是工作区不动。
```sh
git reset --mixed 索引号2
```
把hard参数换为**soft**参数，执行后本地区指针移动的同时，暂存区与工作区都不动.
```sh
git reset --soft 索引号2
```
### 删除与找回本地区的文件
执行如下代码把test2.txt上传到缓存区
```sh
git add test2.txt
git commit -m "添加test2.txt文件"
```
然后把该文件删除，可以直接选中文件右键删除，或者输入rm test2.txt
*此时仅仅把工作区的文件删除了，但是暂存区还保留着，所以需要同步删除操作*
```sh
git add test2.txt
```
此时输入*git status* 会提示你已经删除了暂存区的test2.txt
*此时仅仅把暂存区的文件删除了，但是本地区还保留着，所以需要同步删除操作*
```sh
git commit -m "删除test2.txt" test2.txt
```
**注意，本地区的删除操作其实并不是物理意义上的删除，而是回退到没有该文件的版本，所以找回本地区中删除的文件，实际上就是将历史版本切换到添加文件的版本就行**
### diff比对文件差异
创建test3.txt文件，并写入aaaa四个字母然后上传到本地区
```sh
git add test3.txt
git commit -m "提交了test3.txt"
```
此时输入*git status* 显示没有需要更新的信息(nothing to commit)
*然后接着打开test3.txt文件，把aaaa删掉输入aaaabbb*
这样就造成了工作区文件内容和暂存区的内容不一样，此时输入
```sh
git diff test3.txt
```
执行后会显示文件内容的差异，**git是按照行来管理文件内容的**
直接输入diff不加参数，就会比对工作区下所有文件与暂存区的差异
```sh
git diff
```
这样就完成了多个文件的差异
**比较暂存区与本地区的文件差异**
```sh
git diff HEAD test3.txt
```
*HEAD代表当前本地区的版本索引号，也可以换成其他历史版本的索引号，当前版本的索引号可以直接用HEAD代表。*

执行后会输出当前版本下本地区的test3.txt文件与暂存区的test3.txt文件的差异
## 分支
*用git来管理项目的思想就是基于分支(branch)*
可以把一个项目的发展和改动的历史形象理解为一个数据结构中的树
**一般来说，当要增加新的功能或者对现有版本进行改bug操作都需要新建一个分支，防止影响到主线，等功能测试稳定之后再合并到主线里**
### 分支的好处
同时多个分支可以并行开发，互相不耽误，不影响，提高效率
### 查看分支
```sh
git branch -v
```
输入之后可以查看当前项目下的*所有分支*，当前所在的分支前面会有一个*星号表示

### 创建分支
```sh
git branch branch1
```
创建名为branch1的分支
### 切换分支
```sh
git checkout branch1
```
执行后会切换到branch1分支
### 合并到主分支
*把别的分支合并到主分支时，首先要切换回主分支*
```sh
git checkout master
```
将branch1的内容和主分支的内容进行合并
```sh
git merge branch1
```
假设你在branch1分支下的test4.txt第2行内容为“这是branch1分支”，master分支下的test4.txt第2行内容为“这是主分支”，**如果同一文件的同一位置内容不同，合并分支时就会发生冲突**
```sh
CONFLICT(content):Merge conflict in test4.txt
Automatic merge failed:fix conflicts and then commit the result
```
上述信息提醒用户test4.txt文件出现冲突
*显示(master|MERGING)代表处于合并状态*
此时直接鼠标双击test4.txt文件打开，或者cat test4.txt会发现内容如下
```sh
abc
<<<<<<< HEAD #这个HEAD表示这是当前分支修改的内容
这是主分支
========
这是branch1分支
>>>>>>> branch1
```
**解决方法：人为删除不想要的改动就行，然后提交本地区和暂存区。注意此时输入add和commit命令会提醒你此时还是处于合并状态，所以这时输入commit命令不能加文件名，否则会报错**
```sh
git commit -m "解决冲突"
```
## 在本地创建远程库的别名
因为远程库的地址非常长，每次都要去复制，比较麻烦，可以在本地取一个别名。
### 查看别名
进入工作区路径输入
```sh
git remote -v
```
即可查看该远程地址的别名
### 创建别名
```sh
git remote add 别名 远程库地址
```
## 推送操作push
```sh
git push 别名 你要推送的分支名
```
## 克隆操作
```sh
git clone 远程库地址
```
*克隆操作可以帮我们完成*
1 初始化本地区
2 将远程库内容完整的克隆到本地
3 替我们创建远程库的别名
## 拉取操作pull
拉取操作相当于fetch(抓取)与merge结合的操作
**fetch抓取操作执行后，只是将远程库的内容下载到本地，但是工作区中的文件并没有更新，工作区路径下的文件还是原来的那些**
抓取之后可以去远程库看看内容是否正确
```sh
git checkout origin/master #origin只是一个别名，其他别名也可
```
执行之后，会输出对应分支下的文件列表
切换到当前的本地区master分支，然后进行merge操作
```sh
git merge origin/master #origin只是一个别名，其他别名也可
```
**直接用pull命令与上述分步实现效果一样**
```sh
git pull origin master #origin是远程库别名，master是想要拉取的分支
```
## 删除git缓存
此处的缓存指的其实是用户的账号密码，在WIN10搜索中搜索**凭据管理器**，选择windows凭据这时候就能对github的缓存进行操作了。
## 邀请别人加入团队
假设A和B两人想一起开发一个项目，A建立远程仓库之后，此时若B直接push代码，会报错。
你必须把B邀请进团队才行。点击远程仓库的setting选择*collaborators*，再点击Add people即可邀请别人。B收到邀请邮件，只需在浏览器打开邀请链接同意邀请即可。
## 多人协同开发冲突
比如A和B一起开发一个项目，A拉取下来代码（此时为版本1），接着B拉取下来代码（此时还是版本1，没发生改变）。然后B对代码进行修改同时提交到远程库，此时为版本2。接着A对本地区的代码（他的本地区此时还是版本1）进行修改，**恰好两人修改的是同一个文件的同一个位置**，那么此时A修改完之后，是不能推送到远程库的，会报错。

*解决方法*：A拉取下来代码，找到冲突的文件，手动修改文件内容，保留想要的代码，然后重新推送就行（这一步的操作，和解决分支冲突的一样）

## SSH免密操作
WIN10自带凭据管理器比较方便，但是如果没有凭据管理器就比较麻烦。所以实际开发中，我们大部分情况都是用SSH链接推送而不是HTTP链接推送。
### 1进入用户主目录
这个主目录路径其实就是C盘的用户/用户名
在git bash中输入
```sh
cd ~
```
### 2生成.ssh目录
```sh
ssh-keygen -t rsa -C 填写账号的邮箱
```
注意：参数C是大写C。
执行后会让你选择方式，一般一路默认就行
这时候主目录下会有一个.ssh的文件夹
### 3打开.ssh目录下的id_rad_pub文件
打开这个文件，并复制里面的内容
### 4打开github账号设置
打开账号设置，选择*SSH and GPG keys*在SSH keys一栏选择*New SSH key*。接着填写
*Title*(名字任意)，*key*中填写第三步复制的内容
生成密钥之后，就能正常推送了
### 5对SSH链接取别名
在远程仓库复制SSH链接之后，打开git bash输入取别名的命令
```sh
git remote add 别名 SSH链接
```
执行完之后还是利用
```sh
git remote -v
```
查看别名
*SSh方式的缺陷是只能对一个账号进行免密操作，换账号的话还得这么来一遍*





